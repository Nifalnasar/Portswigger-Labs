## Question:

![image](https://github.com/Nifalnasar/Portswigger-Labs/assets/141356053/90ff43e0-9fd5-4144-a143-c1920d8e9009)

## Solution:

Visit a product page, click "Check stock", and intercept the resulting POST request in Burp Suite.

![image](https://github.com/Nifalnasar/Portswigger-Labs/assets/141356053/f91a5bd2-0607-4ffd-88e3-34194eaebdcf)

Insert the following external entity definition in between the XML declaration and the stockCheck element:

`<!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://169.254.169.254/"> ]>`

Replace the productId number with a reference to the external entity: `&xxe`;. The response should contain "Invalid product ID:" followed by the response from the metadata endpoint, which will initially be a folder name.

![image](https://github.com/Nifalnasar/Portswigger-Labs/assets/141356053/1a018455-5b36-41b9-a9dd-7af8b97a312e)

Iteratively update the URL in the DTD to explore the API until you reach `/latest/meta-data/iam/security-credentials/admin`. This should return JSON containing the SecretAccessKey.

![image](https://github.com/Nifalnasar/Portswigger-Labs/assets/141356053/fa5dcb0a-6633-49e2-9bf9-1490ad979823)
![image](https://github.com/Nifalnasar/Portswigger-Labs/assets/141356053/7e71b2f1-8243-4f80-8185-985d8e77ed42)
![image](https://github.com/Nifalnasar/Portswigger-Labs/assets/141356053/56b1c555-aa9f-4420-be22-24f79e29cf93)
![image](https://github.com/Nifalnasar/Portswigger-Labs/assets/141356053/a3fb2426-001d-4d0c-98ae-1fdf270eedcc)

Lab Solved:

![image](https://github.com/Nifalnasar/Portswigger-Labs/assets/141356053/0d4b5c81-55ba-488c-aac6-4ec190cb9252)







